<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Szachy z AI</title>

<link rel="stylesheet"
href="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"/>

<style>
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial;
    background: #1e1e1e;
    color: white;
}
#board {
    width: 400px;
    margin-top: 20px;
}
</style>
</head>
<body>

<h1>♟️ Szachy z AI</h1>
<div id="board"></div>

<script src="https://unpkg.com/chess.js@1.0.0/chess.min.js"></script>
<script src="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

<script>
const game = new Chess();

const board = Chessboard('board', {
    draggable: true,
    position: 'start',
    onDrop: onDrop
});

function onDrop(source, target) {
    let move = game.move({
        from: source,
        to: target,
        promotion: 'q'
    });

    if (move === null) return 'snapback';

    setTimeout(makeAIMove, 250);
}

function makeAIMove() {
    let bestMove = minimaxRoot(2, game, true);
    game.move(bestMove);
    board.position(game.fen());
}

function minimaxRoot(depth, game, isMaximisingPlayer) {
    let moves = game.moves();
    let bestValue = -9999;
    let bestMove = null;

    for (let move of moves) {
        game.move(move);
        let value = minimax(depth - 1, game, -10000, 10000, false);
        game.undo();

        if (value > bestValue) {
            bestValue = value;
            bestMove = move;
        }
    }
    return bestMove;
}

function minimax(depth, game, alpha, beta, isMaximisingPlayer) {
    if (depth === 0) return evaluateBoard(game.board());

    let moves = game.moves();

    if (isMaximisingPlayer) {
        let maxEval = -9999;
        for (let move of moves) {
            game.move(move);
            let eval = minimax(depth - 1, game, alpha, beta, false);
            game.undo();
            maxEval = Math.max(maxEval, eval);
            alpha = Math.max(alpha, eval);
            if (beta <= alpha) break;
        }
        return maxEval;
    } else {
        let minEval = 9999;
        for (let move of moves) {
            game.move(move);
            let eval = minimax(depth - 1, game, alpha, beta, true);
            game.undo();
            minEval = Math.min(minEval, eval);
            beta = Math.min(beta, eval);
            if (beta <= alpha) break;
        }
        return minEval;
    }
}

function evaluateBoard(board) {
    const values = {
        p: 10, n: 30, b: 30, r: 50, q: 90, k: 900
    };

    let total = 0;
    for (let row of board) {
        for (let piece of row) {
            if (piece) {
                let value = values[piece.type];
                total += piece.color === 'w' ? value : -value;
            }
        }
    }
    return total;
}
</script>

</body>
</html>
